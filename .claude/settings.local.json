{
  "permissions": {
    "allow": [
      "Bash(tail:*)",
      "Bash(export PATH=\"$PATH:/c/Users/y6104/flutter/bin\" && cd /c/drezzy_app && flutter analyze lib/features/listings/presentation/screens/discovery_feed_screen.dart 2>&1)",
      "Bash(cmd:*)",
      "Bash(cd \"C:/drezzy_app\" && file android/gradle/wrapper/gradle-wrapper.jar 2>&1 && python3 -c \"\nimport zipfile, sys\ntry:\n    z = zipfile.ZipFile\\('android/gradle/wrapper/gradle-wrapper.jar'\\)\n    names = z.namelist\\(\\)\n    main = [n for n in names if 'GradleWrapperMain' in n]\n    print\\('Valid JAR. Files:', len\\(names\\)\\)\n    print\\('GradleWrapperMain:', main\\)\nexcept Exception as e:\n    print\\('INVALID JAR:', e\\)\n\" 2>&12)",
      "Bash(cd \"C:/drezzy_app\" && git update-index --chmod=+x android/gradlew && git ls-files --stage android/gradlew 2>&1)",
      "Bash(cd \"C:/drezzy_app\" && git add .github/workflows/build_apk.yml && git status 2>&1)",
      "Bash(cd \"C:/drezzy_app\" && git commit -m \"$\\(cat <<'EOF'\nfix: repair corrupted gradle-wrapper.jar and gradlew permissions\n\nTwo root causes for the CI 'Exit code 1' failure:\n\n1. android/gradle/wrapper/gradle-wrapper.jar was committed as an HTML\n   document \\(likely intercepted by a proxy during initial setup\\).\n   Java could not load GradleWrapperMain from it.\n   Fix: add a CI step that installs Gradle 8.3 via gradle/actions/setup-gradle\n   and runs `gradle wrapper` to regenerate the valid binary before the build.\n\n2. android/gradlew had mode 100644 \\(not executable\\) in git.\n   On Linux runners flutter build calls ./gradlew which requires +x.\n   Fix: git update-index --chmod=+x android/gradlew \\(mode now 100755\\).\n\nAlso adds cache: true to flutter-action for faster subsequent builds.\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\" 2>&1)",
      "Bash(cd \"C:/drezzy_app\" && git push origin main 2>&1)",
      "Bash(cd \"C:/drezzy_app\" && git add .github/workflows/build_apk.yml && git commit -m \"$\\(cat <<'EOF'\nfix\\(ci\\): disable wrapper validation and dependency graph in setup-gradle\n\nsetup-gradle was running its checksum validation against the corrupted\ngradle-wrapper.jar \\(HTML file\\) and failing the build before the\nregeneration step had a chance to replace it.\n\nChanges:\n- wrapper-validation-enabled: false  — bypass jar checksum so the action\n  completes and puts Gradle 8.3 on PATH without error\n- dependency-graph: disabled         — not needed; also requires a valid\n  wrapper and would fail for the same reason\n- Order preserved: Regenerate Gradle wrapper step still runs immediately\n  after setup-gradle, before any other Gradle or Flutter task\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\" 2>&1)",
      "Bash(cd \"C:/drezzy_app\" && git add .github/workflows/build_apk.yml && git commit -m \"$\\(cat <<'EOF'\nfix\\(ci\\): replace setup-gradle with direct Gradle download to bypass validation\n\ngradle/actions/setup-gradle@v4 unconditionally validates gradle-wrapper.jar\nchecksums against Gradle's published list — the flag wrapper-validation-enabled\ndoes not exist in v4 and the validation cannot be disabled via inputs.\n\nThe action was failing at the validation step before the regeneration step\ncould replace the corrupted jar \\(HTML file committed in error\\).\n\nFix: remove setup-gradle entirely. Instead:\n  1. wget gradle-8.3-bin.zip from services.gradle.org\n  2. unzip and run gradle wrapper to regenerate a valid gradle-wrapper.jar\n  3. chmod +x gradlew\n\nNo action touches the corrupted jar before it is overwritten.\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\" 2>&1)",
      "Bash(cd \"C:/drezzy_app\" && git add .github/workflows/build_apk.yml && git commit -m \"$\\(cat <<'EOF'\nfix\\(ci\\): move Flutter setup before Gradle and write local.properties\n\nTwo issues causing the 'Flutter SDK not found' error:\n\n1. subosito/flutter-action was running AFTER the Gradle wrapper step,\n   so FLUTTER_ROOT was not set when Gradle first ran. Flutter must be\n   set up first so the environment variable is available.\n\n2. android/local.properties is in .gitignore and never committed.\n   Gradle reads flutter.sdk from this file to locate flutter.gradle.\n   Without it the build fails with \"Flutter SDK not found\".\n   Added a step that writes: flutter.sdk=$FLUTTER_ROOT immediately\n   after Flutter is set up and FLUTTER_ROOT is defined.\n\nStep order is now:\n  Java → Flutter \\(sets FLUTTER_ROOT\\) → write local.properties\n  → wget Gradle + regenerate wrapper → pub get → build apk\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\" 2>&1)",
      "Bash(cd \"C:/drezzy_app\" && git add android/settings.gradle android/build.gradle android/app/build.gradle .github/workflows/build_apk.yml && git status 2>&1)",
      "Bash(cd \"C:/drezzy_app\" && git commit -m \"$\\(cat <<'EOF'\nbuild\\(android\\): migrate to Flutter Gradle Plugin declarative style\n\nFlutter 3.x deprecated the imperative apply-from approach. The old\nbuildscript{} + apply from: flutter.gradle pattern causes the\n'declarative plugins block' error with AGP 8.x.\n\nandroid/settings.gradle — full rewrite:\n  - Added pluginManagement {} block that reads flutter.sdk from\n    local.properties and calls includeBuild\\(\\) on the Flutter tools gradle dir\n  - Declared all plugins with versions \\(apply false\\) in plugins {} block:\n      dev.flutter.flutter-plugin-loader 1.0.0\n      com.android.application          8.1.4\n      org.jetbrains.kotlin.android     1.8.22\n      com.google.gms.google-services   4.4.2\n\nandroid/build.gradle — removed buildscript {} entirely:\n  - Plugin classpaths and versions now live in settings.gradle\n  - Kept allprojects {}, buildDir config, and clean task\n\nandroid/app/build.gradle — full rewrite:\n  - Replaced three apply plugin/from lines with plugins {} block:\n      com.android.application\n      kotlin-android\n      dev.flutter.flutter-gradle-plugin\n      com.google.gms.google-services\n  - Removed manual flutter.sdk / flutterVersionCode boilerplate\n  - namespace \"com.drezzy.app\" preserved\n  - minSdkVersion 21, targetSdkVersion 34, multiDexEnabled preserved\n\n.github/workflows/build_apk.yml:\n  - Pinned flutter-version: '3.41.2' to match the target environment\n  - Added sdk.dir=$ANDROID_HOME to local.properties creation step\n\nCo-Authored-By: Claude Sonnet 4.6 <noreply@anthropic.com>\nEOF\n\\)\" 2>&1)"
    ]
  }
}
